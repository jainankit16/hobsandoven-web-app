<div class="card-body">
	<div class="row">
		<div class="col-6">
			<h3 class="text-themecolor ml-3">
				<i class="fa fa-list-ul"></i> {{pageTitle}}
			</h3>
		</div>
	</div>
	<div class="row p-t-10 p-b-10">
		<div class="col-6">
			<div class="form-group m-b-0">
				<!-- <i class="fa fa-search icon-color"></i> -->
				<input type="text" class="form-control" placeholder='Search by Job Id...' (keyup)='filterByJobId($event)' [(ngModel)]="filterJobValue">
			</div>
		</div>
		<div class="col-6 text-right">
			<button type="button" class="btn btn-sm mRight" (click)="open(advancedFilters, 'xl')" i18n>
				<i class="fa fa-filter"></i> Filters
			</button>
			<button type="button" class="btn btn-sm mRight editColumn" i18n>
				<i class="fa fa-th"></i> Edit Columns
			</button>
			<div class="dd-column-selector">
				<li *ngFor='let col of allColumns' class="p-l-5">
					<input *ngIf="col.name !=''" type='checkbox' [id]="col.name" (click)='toggle(col)' [checked]='col.visible' />
					<label *ngIf="col.name !=''" [attr.for]="col.name">{{col.name}}</label>
				</li>
			</div>
			<button type="button" class="btn btn-sm mRight" (click)="refreshView();" i18n>
				<i class="fa fa-refresh"></i> Refresh
			</button>
			<button *ngIf="tableData[0] && !tableData[0]['message']" class="btn btn-sm" (click)="exportCSV()">
				<i class="fa fa-download"></i> CSV</button>
		</div>
	</div>
	<div class="form-material m-t-5">
		<ngx-datatable #myTable class="material striped  fullscreen doubleScroll" [rows]="tableData" [loadingIndicator]="loadingIndicator"
		 [columnMode]="'standard'" [limit]="10" [headerHeight]="100" [footerHeight]="50" [rowHeight]="80" [sortType]="'single'"
		 [scrollbarH]="false" ngx-resize-watcher>
			<div *ngFor="let col of columns">
				<ngx-datatable-column *ngIf="col.visible" [name]="col.name" [prop]="col.prop" [width]="col.width" [sortable]="col.sortable">
					<ng-template *ngIf="col.prop == 'Iron_Job_num__c'" let-row="row" let-value="value" ngx-datatable-cell-template>
						<span *ngIf="row.sfdcId">
							<a [routerLink]="['/vms/jobs/view', row.sfdcId]" target="_blank" title="{{value}}">
								{{value}}
							</a>
						</span>
						<span *ngIf="tableData[0]['message']">{{value}}</span>
						<div class="clearfix"></div>
						<!-- when job record type is FRU Dispatch -->
						<span *ngIf="row.RecordTypeId == '0121a000000F1eoAAC'">
							<img src="./../../../../../assets/img/icons/delivery-box-1.png">&nbsp;
							<img src="./../../../../../assets/img/icons/smart-hand-2.png">
						</span>
						<!-- when job record type is FSE DIspatch -->
						<span *ngIf="row.RecordTypeId == '0121a0000006QndAAE'">
							<img src="./../../../../../assets/img/icons/delivery-box-2.png">&nbsp;
							<img src="./../../../../../assets/img/icons/smart-hand-1.png">
						</span>
					</ng-template>
					<ng-template let-column="column" height="200" let-sort="sortFn" ngx-datatable-header-template>
						<span class="datatable-header-cell-wrapper float-left">
							<span class="datatable-header-cell-label draggable" (click)="sort()">
								{{col.name}}
							</span>
						</span>
						<div class="input-group float-right" *ngIf="col.prop != 'Job_Status_Internal__c' && col.type !='date'">
							<input type='text' [id]="col.prop" name="col.prop" class="form-control" style='font-size: 14px;padding-left:2px;' placeholder="Type to search..."
							 (keyup)='filterData($event, "text")' [(ngModel)]="filterObj[col.prop]" [ngModelOptions]="{standalone: true}" />
							<span class="input-group-btn">
								<a class="dataTable-cross" (click)="clearSearch(col.prop);" href="javascript:void(0);">
									<i class="fa fa-times suffex cross"></i>
								</a>
							</span>
						</div>
						<div class="input-group float-right" *ngIf="col.prop == 'Job_Status_Internal__c' ">
							<select *ngIf="!searchArray['Job_Status_Internal__c']" [id]="col.prop" class="form-control" style='font-size: 14px;padding-left:2px;'
							 placeholder="Type to search..." (change)='filterData($event)'>
								<option value="">All</option>
								<option *ngFor="let status of JobStatusInternalValues" [value]="status.value">{{status.label}}</option>
							</select>
							<span class="status-Label" *ngIf=" searchArray['Job_Status_Internal__c']">{{searchArray['Job_Status_Internal__c']}}</span>
						</div>
						<div class="input-group float-right form-material" *ngIf="col.type =='date'">
							<input [owlDateTimeTrigger]="dt" class="form-control t-search-tb" placeholder="Select Date..." [id]="col.prop" [owlDateTime]="dt"
							 (dateTimeChange)='filterData($event,"date")' readonly="true" [(ngModel)]="col.value" [ngModelOptions]="{standalone: true}">
							<owl-date-time #dt [pickerType]="'calendar'"></owl-date-time>
							<span class="input-group-btn">
								<a class="dataTable-cross" (click)="clearSearch(col.prop); col.value='';" href="javascript:void(0);">
									<i class="fa fa-times suffex cross"></i>
								</a>
							</span>
						</div>

					</ng-template>
					<ng-template *ngIf="col.prop == 'Cust_Requested__c'" let-value="value" ngx-datatable-cell-template>
						<span>{{value | date:'short'}}</span>
					</ng-template>
					<ng-template *ngIf="col.prop == 'Cust_Scheduled__c'" let-value="value" ngx-datatable-cell-template>
						<span>{{value | date:'short'}}</span>
					</ng-template>
					<ng-template *ngIf="col.prop == 'Worker_Scheduled__c'" let-value="value" ngx-datatable-cell-template>
						<span>{{value | date:'short'}}</span>
					</ng-template>
					<ng-template *ngIf="col.prop == 'Worker_Arrival__c'" let-value="value" ngx-datatable-cell-template>
						<span>{{value | date:'short'}}</span>
					</ng-template>
					<ng-template *ngIf="col.prop == 'CreatedDate'" let-value="value" ngx-datatable-cell-template>
						<span>{{value | date:'short'}}</span>
					</ng-template>
					<ng-template *ngIf="col.prop == 'updatedAt'" let-value="value" ngx-datatable-cell-template>
						<span>{{value | date:'short'}}</span>
					</ng-template>
					<ng-template *ngIf="col.prop == 'Customer_Requested'" let-value="value" ngx-datatable-cell-template>
						<span>{{value | date:'short'}}</span>
					</ng-template>
				</ngx-datatable-column>
			</div>
			<ngx-datatable-footer>
				<ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="pageSize" let-selectedCount="selectedCount"
				 let-curPage="curPage" let-offset="offset">
					<div style="padding: 5px 10px">
						<div>
							Total: {{((tableData[0]) && !tableData[0]['message']) ? rowCount : 0}}
						</div>
					</div>
					<datatable-pager [pagerLeftArrowIcon]="'datatable-icon-left'" [pagerRightArrowIcon]="'datatable-icon-right'" [pagerPreviousIcon]="'datatable-icon-prev'"
					 [pagerNextIcon]="'datatable-icon-skip'" [page]="curPage" [size]="pageSize" [count]="rowCount" [hidden]="!((rowCount / pageSize) > 1)"
					 (change)="myTable.onFooterPage($event)">
					</datatable-pager>
					<div style="padding: 5px 10px" class="ml-auto" *ngIf="isLoadMore">
						<div>
							<button class="btn btn-sm" (click)="loadMoreRecords()">Load More</button>
						</div>
					</div>
				</ng-template>
			</ngx-datatable-footer>
		</ngx-datatable>
	</div>
</div>

<!-- Advanced Search Modal Popup -->
<ng-template #advancedFilters let-c="close" let-d="dismiss">
	<div class="modal-header">
		<h4 class="modal-title">Filters</h4>
		<button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<div class="row">
			<div class="col-sm-3" *ngFor="let col of columns; let i=index">
				<div class="form-group">
					<span class="text-muted">
						<strong>{{col.name}}</strong>
					</span>
					<div class="input-group form-material" *ngIf="col.prop != 'Job_Status_Internal__c' && col.type !='date'">
						<input type='text' [id]="col.prop" name="col.prop" class="form-control" style='font-size: 14px;padding-left:2px;' placeholder="Type To Search"
						 [(ngModel)]="sSfilter[col.prop]" [ngModelOptions]="{standalone: true}" />
						<span class="input-group-btn">

							<a class="dataTable-cross" (click)="clearsSfilter(col.prop);" href="javascript:void(0);" *ngIf="sSfilter[col.prop]">
								<i class="fa fa-times suffex cross"></i>
							</a>
						</span>
					</div>
					<div class="input-group form-material" *ngIf="col.prop == 'Job_Status_Internal__c'">
						<select *ngIf="!searchArray['Job_Status_Internal__c']" [id]="col.prop" class="form-control" style='font-size: 14px;padding-left:2px;'
						 placeholder="Type to search..." [(ngModel)]="sSfilter[col.prop]" [ngModelOptions]="{standalone: true}">
							<option value="">All</option>
							<option *ngFor="let status of JobStatusInternalValues" [value]="status.value">{{status.label}}</option>
						</select>
						<span class="status-Label" *ngIf=" searchArray['Job_Status_Internal__c']">{{searchArray['Job_Status_Internal__c']}}</span>
					</div>
					<div class="input-group form-material" *ngIf="col.type =='date'">
						<input [owlDateTimeTrigger]="dt" class="form-control t-search-tb" placeholder="Select Date..." [id]="col.prop" [owlDateTime]="dt"
						 [(ngModel)]="sSfilter[col.prop]" [ngModelOptions]="{standalone: true}" [selectMode]="'range'">
						<owl-date-time #dt [pickerType]="'calendar'"></owl-date-time>
						<span class="input-group-btn" *ngIf="sSfilter[col.prop]">
							<a class="dataTable-cross" (click)="clearsSfilter(col.prop);" href="javascript:void(0);">
								<i class="fa fa-times suffex cross"></i>
							</a>
						</span>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-3 offset-md-9 pull-right">
				<button class="btn btn-sm btn-primary mRight" (click)="sSfilterData()">
					<i class="fa fa-search"></i> Search
				</button>
				<button class="btn btn-sm btn-default" (click)="resetsSfFilter()">
					<i class="fa fa-times"></i> Clear
				</button>
			</div>
		</div>
	</div>
</ng-template>