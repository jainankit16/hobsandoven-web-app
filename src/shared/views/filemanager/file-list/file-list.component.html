<!--Search document list form start here-->
<!-- 
    <alert></alert> -->

    <div class="row">
        <div class="col-6 text-left" *ngIf="user?.LocalAccountId">
            <!-- <button type="button" class="btn btn-sm btn-primary" (click)="open(uploadContent,'lg');" i18n>
                <i class="mdi mdi-camera"></i> Upload
            </button> -->
        </div>
        <div class="col-6 text-right">
            <div class="switch">
                <label>Folder View
                    <input type="checkbox" checked="" (change)="changeView($event)">
                    <span class="lever switch-col-purple"></span>List View</label>
            </div>
        </div>
    </div>
    
    <div *ngIf="allowFiltering" class="card p-2 hide-select-overlay">
        <div class="row">
            <div class="col-3" *ngIf="userAccessType === 'internal'">
                <ng-select [items]="accountFilterItems" bindLabel="Name" bindValue="sfdcId" [disabled]="isAccountDisabled" placeholder="Filter by Account"
                    [multiple]="true" [typeahead]="accountsTypeahead" [(ngModel)]="accountsSelected" (change)="onAccountChnage()"
                    [notFoundText]="noAccount" (clear)="clearPrograms()" dropdownPosition="bottom">
                </ng-select>
            </div>
            <div class="col-3">
                <ng-select [items]="departments" bindLabel="Name" bindValue="id" placeholder="Filter by Department" [multiple]="true" [loading]="departmentsLoading"
                    [(ngModel)]="departmentsSelected" dropdownPosition="bottom">
                </ng-select>
            </div>
            <div class="col-3">
                <ng-select [items]="modelsList" bindValue="value" bindLabel="label" placeholder="Related To" [multiple]="true" [(ngModel)]="modelsSelected"
                dropdownPosition="bottom">
                </ng-select>
            </div>
            <div class="col-3">
                <ng-select [items]="programFilterItems" bindLabel="name" bindValue="id" placeholder="Filter by Program" [multiple]="true"
                    [(ngModel)]="programsSelected" [loading]="programLoading" [notFoundText]="'No Programs found'" groupBy="account"
                    [selectableGroup]="false" class="custom" dropdownPosition="bottom">
                </ng-select>
            </div>
    
        </div>
        <div class="row">
            <div class="col-3">
                <ng-select [items]="categories" bindLabel="title" bindValue="id" placeholder="Filter by Document Category" [multiple]="true"
                    [loading]="categoriesLoading" [(ngModel)]="categoriesSelected" dropdownPosition="bottom">
                </ng-select>
            </div>
            <div class="col-3">
                <ng-select [items]="subCategories" bindLabel="title" bindValue="id" placeholder="Filter by Document Title" [multiple]="true"
                    groupBy="parent" [selectableGroup]="false" [loading]="subCategoriesLoading" [(ngModel)]="subCategoriesSelected" dropdownPosition="bottom">
                </ng-select>
            </div>
            <div class="col-3">
                <div style="margin-top:15px;">
                    <form class="form-material">
                        <input class="form-control" [selectMode]="'range'" [(ngModel)]="selectedRange" #mydatefrom [ngModelOptions]="{standalone: true}"
                            [owlDateTime]="dateFrom" [max]="maxDate" [owlDateTimeTrigger]="dateFrom" placeholder="Filter by Upload Date"
                            readonly="true" dropdownPosition="bottom"/>
                        <owl-date-time #dateFrom></owl-date-time>
                    </form>
                </div>
            </div>
            <div class="col-3">
                <div style="margin-top:19px;">
                    <button class="btn btn-sm btn-primary mRight" (click)="filterDocuments()">
                        <i class="fa fa-search"></i> Search
                    </button>
                    <button class="btn btn-sm btn-default" (click)="resetFilters()">
                        <i class="fa fa-times"></i> Clear
                    </button>
                </div>
            </div>
        </div>
    
    </div>
    
    <!--End here-->
    <!--Document List view start here-->
    
    <div class="card m-t-5" *ngIf="isTableData">
        <ngx-datatable #myTable class="material striped" [rows]="tableData" [limit]="itemsPerPage" [loadingIndicator]="loadingIndicator"
            [columnMode]="(tableData.length) ? 'force' : 'flex'" [limit]="10" [headerHeight]="(tableData.length) ? 60 : 'auto'" [footerHeight]="50"
            [rowHeight]="60" [reorderable]="true" [scrollbarH]="true">
    
            <ngx-datatable-column name="File Name" prop="filename" [resizeable]="true" [width]="350" [frozenLeft]="(tableData[0] && tableData[0]['message']) ? '' : true">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span class="text-wrap" *ngIf="row.id">
                        <i class="{{ row?.fileMeta | fileicon }}"></i>
                        {{row?.Name}}
                    </span> &nbsp;
                    <i *ngIf="row.description !== '' && row.id" class="fa fa-info-circle icon-color" placement="right" [ngbPopover]="row.description"
                        triggers="hover" container="body"></i>                    
                    <span *ngIf="(tableData[0] && tableData[0]['message'])">
                        {{tableData[0]['message']}}
                    </span>
                </ng-template>
    
            </ngx-datatable-column>
            <ngx-datatable-column name="Account" prop="accountName" [width]="300" [resizeable]="true">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span class="text-wrap"> {{row?.accountName}}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Document Title" prop="subCategory" [width]="250" [resizeable]="true">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span class="text-wrap"> {{(row?.subCategory) ? row.subCategory : ''}}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Document Category" prop="category" [width]="250" [resizeable]="true">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span class="text-wrap"> {{(row?.category) ? row.category: ''}}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Department" prop="departmentName" [width]="200" [resizeable]="true">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span class="text-wrap"> {{row?.departmentName}}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Related To" prop="modelName" [width]="150"></ngx-datatable-column>
            <ngx-datatable-column name="Size" prop="size" [width]="150">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span *ngIf="row.id"> {{row?.size | filesize}}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Uploaded By" prop="uploadedBy" [width]="300" [resizeable]="true"></ngx-datatable-column>
            <ngx-datatable-column name="Date Uploaded" prop="createdAt" [width]="300">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    <span>{{value | date:'short'}}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Action" prop="action" [width]="100">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <a *ngIf="row.id" style="text-decoration:none;" title="View/Download" class="icon-size" href="{{containerPath}}{{row?.fileMeta?.path}}"
                        target="_blank">
                        <i class="{{ row.fileMeta | fileicon : true }}">&nbsp;</i>
                    </a>
                </ng-template>
            </ngx-datatable-column>
    
            <ngx-datatable-footer>
                <ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="pageSize" let-selectedCount="selectedCount"
                    let-curPage="curPage" let-offset="offset">
                    <div style="padding: 5px 10px">
                        <div>
                            Total: {{((tableData[0]) && !tableData[0]['message']) ? rowCount : 0}}
                        </div>
                    </div>
                    <datatable-pager [pagerLeftArrowIcon]="'datatable-icon-left'" [pagerRightArrowIcon]="'datatable-icon-right'" [pagerPreviousIcon]="'datatable-icon-prev'"
                        [pagerNextIcon]="'datatable-icon-skip'" [page]="curPage" [size]="pageSize" [count]="rowCount" [hidden]="!((rowCount / pageSize) > 1)"
                        (change)="myTable.onFooterPage($event)">
                    </datatable-pager>
                    <div style="padding: 5px 10px" [hidden]="!((rowCount / pageSize) > 1) || noRecords">
                        <div>
                            <button class="btn btn-sm" (click)="loadMoreRecords()">Load More</button>
                        </div>
                    </div>
                </ng-template>
            </ngx-datatable-footer>
    
    
        </ngx-datatable>
    </div>
    
    
    <!--End here-->
    
    <!-- File Upload Popup starts here -->
    <!-- <ng-template #uploadContent>
        <app-document-upload modelName='Account' modelId="{{user?.LocalAccountId}}" (uploaded)="documentUploaded($event)" (onModalClose) = "uploadModalClosed($event)">
        </app-document-upload>
    </ng-template> -->
    <!-- File Upload Popup ends here -->